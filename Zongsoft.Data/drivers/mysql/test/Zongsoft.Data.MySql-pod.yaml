apiVersion: v1
kind: Pod
metadata:
  name: zongsoft.data
  labels:
    app: zongsoft.data
spec:
  volumes:
    - name: mysql-config-volume
      configMap:
        name: mysql-config
    - name: init-script
      hostPath:
        path: /mnt/d/Zongsoft/framework/Zongsoft.Data/drivers/mysql/test/script/init.sql
        type: File
  containers:
    - name: mysql
      image: mysql:8.4.6
      ports:
        - containerPort: 3306
          protocol: TCP
          hostPort: 3306
      env:
        - name: LANG
          value: C.UTF-8
        - name: MYSQL_USER
          value: program
        - name: MYSQL_PASSWORD
          value: "xxxxxx"
        - name: MYSQL_ALLOW_EMPTY_PASSWORD
          value: "yes"
        - name: MYSQL_DATABASE
          value: zongsoft
        - name: MYSQL_CHARSET
          value: utf8mb4
        - name: MYSQL_COLLATION
          value: utf8mb4_0900_ai_ci
      volumeMounts:
        - name: init-script
          mountPath: /docker-entrypoint-initdb.d/init.sql
        - name: mysql-config-volume
          mountPath: /etc/mysql/conf.d/local_infile.cnf
          subPath: local_infile.cnf

---

apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-config
data:
  local_infile.cnf: |
    [mysqld]
    local_infile = 1
    [mysql]
    local_infile = 1
    [client]
    local_infile = 1
